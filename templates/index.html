<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GPTå……å€¼ç³»ç»Ÿ</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" />
  <style>
    /* åŠ¨æ€å¼ºè°ƒæ•ˆæœ */
    .highlight-pulse {
      animation: highlightPulse 2s ease-in-out infinite;
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
    }
    
    @keyframes highlightPulse {
      0% {
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
        border-color: #3b82f6;
      }
      70% {
        box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
        border-color: #1d4ed8;
      }
      100% {
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
        border-color: #3b82f6;
      }
    }
    
    /* è¾“å…¥æ¡†èšç„¦æ•ˆæœ */
    .input-focus {
      transition: all 0.3s ease;
      border: 2px solid #e5e7eb;
    }
    
    .input-focus:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      transform: translateY(-1px);
    }
    
    /* æŒ‰é’®æ‚¬åœæ•ˆæœ */
    .btn-hover {
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .btn-hover::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    
    .btn-hover:hover::before {
      left: 100%;
    }
    
    .btn-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
    }
    
    /* æ­¥éª¤æŒ‡ç¤ºå™¨åŠ¨ç”» */
    .step-active {
      animation: stepGlow 1.5s ease-in-out infinite alternate;
    }
    
    @keyframes stepGlow {
      from {
        box-shadow: 0 0 5px rgba(59, 130, 246, 0.5);
      }
      to {
        box-shadow: 0 0 15px rgba(59, 130, 246, 0.8);
      }
    }
    
    /* æç¤ºæ–‡å­—é—ªçƒ */
    .hint-blink {
      animation: hintBlink 2s ease-in-out infinite;
    }
    
    @keyframes hintBlink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }
    
    /* å¡ç‰‡æµ®åŠ¨æ•ˆæœ */
    .card-float {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card-float:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body class="min-h-screen bg-gray-100">
  <div class="max-w-2xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-center mb-2">GPTå……å€¼ç³»ç»Ÿ</h1>
    <p class="text-center text-gray-500 mb-8">å¿«é€Ÿã€å®‰å…¨çš„ ChatGPT Plus å……å€¼æœåŠ¡</p>

    <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
    <div class="flex items-center justify-center space-x-4 mb-6">
      <div class="flex items-center">
        <div id="dot1" class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-semibold">1</div>
        <span class="ml-2">éªŒè¯æ¿€æ´»ç </span>
      </div>
      <div id="line1" class="w-10 h-1 bg-gray-300"></div>
      <div class="flex items-center">
        <div id="dot2" class="w-8 h-8 rounded-full bg-gray-300 text-gray-700 flex items-center justify-center font-semibold">2</div>
        <span class="ml-2">ç”¨æˆ·ä¿¡æ¯</span>
      </div>
      <div id="line2" class="w-10 h-1 bg-gray-300"></div>
      <div class="flex items-center">
        <div id="dot3" class="w-8 h-8 rounded-full bg-gray-300 text-gray-700 flex items-center justify-center font-semibold">3</div>
        <span class="ml-2">å®Œæˆ</span>
      </div>
    </div>

    <div id="msg" class="hidden mb-4 px-4 py-3 rounded text-sm"></div>

    <!-- Step 1 -->
    <div id="step1" class="bg-white rounded shadow p-6 mb-6 card-float">
      <h2 class="text-xl font-semibold mb-4">
        <i class="fa-solid fa-key mr-2 text-blue-600"></i>è¾“å…¥æ¿€æ´»ç 
      </h2>
      <div class="mb-3">
        <p class="text-sm text-gray-600 hint-blink">
          <i class="fa-solid fa-lightbulb mr-1 text-yellow-500"></i>
          è¯·åœ¨ä¸‹æ–¹è¾“å…¥æ¡†ä¸­è¾“å…¥æ‚¨çš„æ¿€æ´»ç 
        </p>
      </div>
      <form id="formVerify" class="space-y-4">
        <div class="relative">
          <input id="code" type="text" placeholder="CARD-XXXX-XXXX-XXXX" 
                 class="w-full input-focus highlight-pulse rounded-lg px-4 py-3 text-lg font-mono text-center tracking-wider" 
                 required />
          <div class="absolute right-3 top-1/2 transform -translate-y-1/2">
            <i class="fa-solid fa-credit-card text-gray-400"></i>
          </div>
        </div>
        <button id="btnVerify" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold btn-hover">
          <i class="fa-solid fa-search mr-2"></i>éªŒè¯æ¿€æ´»ç 
        </button>
      </form>
    </div>

    <!-- Step 2 -->
    <div id="step2" class="hidden bg-white rounded shadow p-6 mb-6 card-float">
      <h2 class="text-xl font-semibold mb-4">
        <i class="fa-solid fa-user mr-2 text-blue-600"></i>ç”¨æˆ·ä¿¡æ¯
      </h2>
      <div class="bg-gray-50 rounded-lg p-4 mb-4">
        <div class="flex items-center mb-2">
          <i class="fa-solid fa-envelope text-blue-500 mr-2"></i>
          <span id="email" class="text-gray-800 font-medium"></span>
        </div>
        <div class="flex items-center">
          <i class="fa-solid fa-info-circle text-green-500 mr-2"></i>
          <span id="status" class="text-gray-800 font-medium"></span>
        </div>
      </div>
      <div id="newUser" class="hidden">
        <div class="mb-3">
          <p class="text-sm text-gray-600 hint-blink">
            <i class="fa-solid fa-lightbulb mr-1 text-yellow-500"></i>
            è¯·åœ¨ä¸‹æ–¹æ–‡æœ¬æ¡†ä¸­ç²˜è´´ä»ChatGPTè·å–çš„JSONæ•°æ®
          </p>
        </div>
        <label class="block text-sm font-semibold mb-3 text-gray-700">
          <i class="fa-solid fa-code mr-2 text-purple-600"></i>ChatGPT JSON Token
        </label>
        <div class="relative">
          <textarea id="json" rows="8" 
                    placeholder='ç²˜è´´ä»ChatGPTè·å–çš„JSONï¼ˆå«access_tokenç­‰ï¼‰' 
                    class="w-full input-focus highlight-pulse rounded-lg px-4 py-3 font-mono text-sm resize-none border-2"></textarea>
          <div class="absolute top-3 right-3">
            <i class="fa-solid fa-paste text-gray-400"></i>
          </div>
        </div>
        <button id="btnSubmitJson" class="mt-4 w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold btn-hover">
          <i class="fa-solid fa-rocket mr-2"></i>å¼€å§‹å……å€¼
        </button>
      </div>
      <div id="oldUser" class="hidden">
        <div class="text-center mb-4">
          <div class="inline-flex items-center px-4 py-2 bg-blue-100 text-blue-800 rounded-lg">
            <i class="fa-solid fa-user-check mr-2"></i>
            <span>æ£€æµ‹åˆ°å·²ä½¿ç”¨çš„æ¿€æ´»ç </span>
          </div>
        </div>

        <!-- å¤ç”¨å……å€¼æŒ‰é’® -->
        <button id="btnReuse" class="w-full py-3 px-6 rounded-lg font-semibold text-white mb-3 btn-hover" style="background: linear-gradient(135deg, #f97316, #ea580c); border: 2px solid #ea580c;">
          <i class="fa-solid fa-rotate mr-2"></i>å¤ç”¨å……å€¼è®°å½•
        </button>

        <!-- æˆ–è€…æ›´æ–°Token -->
        <div class="text-center mb-3">
          <span class="text-gray-500 text-sm">æˆ–è€…</span>
        </div>

        <!-- æ›´æ–°TokenåŒºåŸŸ -->
        <div id="updateTokenSection" class="hidden">
          <div class="mb-3">
            <p class="text-sm text-gray-600 hint-blink">
              <i class="fa-solid fa-lightbulb mr-1 text-yellow-500"></i>
              è¯·ç²˜è´´æ–°çš„ChatGPT JSON Tokenæ¥æ›´æ–°æ‚¨çš„è´¦æˆ·ä¿¡æ¯
            </p>
          </div>
          <label class="block text-sm font-semibold mb-3 text-gray-700">
            <i class="fa-solid fa-code mr-2 text-purple-600"></i>æ›´æ–° ChatGPT JSON Token
          </label>
          <div class="relative">
            <textarea id="updateJson" rows="8" 
                      placeholder='ç²˜è´´æ–°çš„ChatGPT JSON Token' 
                      class="w-full input-focus highlight-pulse rounded-lg px-4 py-3 font-mono text-sm resize-none border-2"></textarea>
            <div class="absolute top-3 right-3">
              <i class="fa-solid fa-sync text-gray-400"></i>
            </div>
          </div>
          <div class="flex space-x-3 mt-4">
            <button id="btnUpdateToken" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold btn-hover">
              <i class="fa-solid fa-upload mr-2"></i>æ›´æ–°Token
            </button>
            <button id="btnCancelUpdate" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-semibold btn-hover">
              <i class="fa-solid fa-times mr-2"></i>å–æ¶ˆ
            </button>
          </div>
        </div>

        <!-- æ˜¾ç¤ºæ›´æ–°TokenæŒ‰é’® -->
        <button id="btnShowUpdate" class="w-full py-3 px-4 rounded-lg border-2 border-gray-300 text-gray-700 hover:bg-gray-50 btn-hover font-semibold">
          <i class="fa-solid fa-edit mr-2"></i>æ›´æ–°Token
        </button>
      </div>
    </div>

    <!-- Step 3 -->
    <div id="step3" class="hidden bg-white rounded shadow p-6 card-float">
      <h2 class="text-xl font-semibold mb-4">
        <i class="fa-solid fa-flag-checkered mr-2 text-blue-600"></i>æ“ä½œå®Œæˆ
      </h2>

      <!-- ç»“æœçŠ¶æ€æ˜¾ç¤º -->
      <div id="resultStatus" class="mb-4"></div>

      <!-- è¯¦ç»†ç»“æœ -->
      <details class="mb-4">
        <summary class="cursor-pointer text-gray-600 hover:text-gray-800 font-medium">
          <i class="fa-solid fa-info-circle mr-1"></i>æŸ¥çœ‹è¯¦ç»†ç»“æœ
        </summary>
        <pre id="result" class="bg-gray-50 rounded-lg p-4 text-sm overflow-auto mt-3 max-h-64 border"></pre>
      </details>

      <button id="btnReset" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold btn-hover">
        <i class="fa-solid fa-refresh mr-2"></i>é‡æ–°å¼€å§‹
      </button>
    </div>
    
    <!-- å®¢æœè”ç³»ä¿¡æ¯ -->
    <div class="mt-12 text-center border-t pt-8">
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold mb-4 text-gray-800">
          <i class="fa-solid fa-headset mr-2 text-blue-600"></i>
          å®¢æœè”ç³»æ–¹å¼
        </h3>
        <div class="space-y-3">
          <p class="text-gray-600">
            <i class="fa-brands fa-weixin mr-2 text-green-500"></i>
            <strong>å¾®ä¿¡å®¢æœï¼š</strong>
            <span class="font-mono text-blue-600">aiplus6688</span>
          </p>
          <div class="text-sm text-gray-500 border-t pt-3">
            <p class="mb-1">ğŸ’¡ æˆ‘ä»¬æä¾›ä»¥ä¸‹æœåŠ¡ï¼š</p>
            <div class="flex flex-wrap justify-center gap-2">
              <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">ChatGPT Proå……å€¼</span>
              <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs">Grok 4å……å€¼</span>
              <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">Grok Heavyå……å€¼</span>
              <span class="px-2 py-1 bg-orange-100 text-orange-800 rounded text-xs">å¹¿å‘Šåˆä½œ</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const setStep = (n) => {
      // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
      $('dot1').className = 'w-8 h-8 rounded-full ' + (n>=1?'bg-blue-600 text-white step-active':'bg-gray-300 text-gray-700') + ' flex items-center justify-center font-semibold';
      $('dot2').className = 'w-8 h-8 rounded-full ' + (n>=2?'bg-blue-600 text-white step-active':'bg-gray-300 text-gray-700') + ' flex items-center justify-center font-semibold';
      $('dot3').className = 'w-8 h-8 rounded-full ' + (n>=3?'bg-blue-600 text-white step-active':'bg-gray-300 text-gray-700') + ' flex items-center justify-center font-semibold';
      $('line1').className = 'w-10 h-1 ' + (n>=2?'bg-blue-600':'bg-gray-300');
      $('line2').className = 'w-10 h-1 ' + (n>=3?'bg-blue-600':'bg-gray-300');
      
      // æ˜¾ç¤º/éšè—æ­¥éª¤
      $('step1').classList.toggle('hidden', n!==1);
      $('step2').classList.toggle('hidden', n!==2);
      $('step3').classList.toggle('hidden', n!==3);
      
      // ç®¡ç†è¾“å…¥æ¡†çš„å¼ºè°ƒæ•ˆæœ
      if (n === 1) {
        // æ¿€æ´»ç è¾“å…¥æ¡†å¼€å§‹è„‰å†²
        $('code').classList.add('highlight-pulse');
      } else {
        $('code').classList.remove('highlight-pulse');
      }
      
      if (n === 2) {
        // JSONè¾“å…¥æ¡†å¼€å§‹è„‰å†²ï¼ˆå»¶è¿Ÿä¸€ä¸‹è®©ç”¨æˆ·çœ‹åˆ°ç”¨æˆ·ä¿¡æ¯ï¼‰
        setTimeout(() => {
          const jsonInput = $('json');
          const updateJsonInput = $('updateJson');
          if (jsonInput && !jsonInput.closest('#newUser').classList.contains('hidden')) {
            jsonInput.classList.add('highlight-pulse');
          }
          if (updateJsonInput && !updateJsonInput.closest('#updateTokenSection').classList.contains('hidden')) {
            updateJsonInput.classList.add('highlight-pulse');
          }
        }, 1000);
      }
    };
    const showMsg = (t, ok=false)=>{ const b=$('msg'); b.classList.remove('hidden'); b.className='mb-4 px-4 py-3 rounded text-sm '+(ok?'bg-green-100 text-green-800':'bg-red-100 text-red-800'); b.textContent=t; };
    const hideMsg = ()=>$('msg').classList.add('hidden');

    // æ˜¾ç¤ºç»“æœçŠ¶æ€
    const showResult = (data) => {
      const success = data.success || false;
      const statusDiv = $('resultStatus');

      if (success) {
        statusDiv.innerHTML = `
          <div class="flex items-center p-4 bg-green-100 border border-green-400 rounded">
            <i class="fa-solid fa-check-circle text-green-600 text-2xl mr-3"></i>
            <div>
              <h3 class="font-semibold text-green-800">æ“ä½œæˆåŠŸï¼</h3>
              <p class="text-green-700 text-sm">${data.message || 'å……å€¼å·²å®Œæˆ'}</p>
            </div>
          </div>
        `;
      } else {
        statusDiv.innerHTML = `
          <div class="flex items-center p-4 bg-red-100 border border-red-400 rounded">
            <i class="fa-solid fa-exclamation-triangle text-red-600 text-2xl mr-3"></i>
            <div>
              <h3 class="font-semibold text-red-800">æ“ä½œå¤±è´¥</h3>
              <p class="text-red-700 text-sm">${data.error || 'æœªçŸ¥é”™è¯¯'}</p>
            </div>
          </div>
        `;
      }

      $('result').textContent = JSON.stringify(data, null, 2);
    };

    // æ ¼å¼åŒ–æ¿€æ´»ç è¾“å…¥
    $('code').addEventListener('input', function(e) {
      let value = e.target.value.replace(/[^A-Z0-9]/g, '').toUpperCase();
      let formatted = '';
      
      if (value.length > 0) {
        if (!value.startsWith('CARD')) {
          if (value.length <= 4) {
            formatted = 'CARD';
            if (value) formatted += '-' + value;
          } else {
            formatted = 'CARD-' + value.substring(0, 4);
            if (value.length > 4) {
              formatted += '-' + value.substring(4, 8);
              if (value.length > 8) {
                formatted += '-' + value.substring(8, 12);
              }
            }
          }
        } else {
          const parts = value.split('');
          formatted = 'CARD';
          let remaining = value.substring(4);
          if (remaining.length > 0) {
            formatted += '-' + remaining.substring(0, 4);
            if (remaining.length > 4) {
              formatted += '-' + remaining.substring(4, 8);
              if (remaining.length > 8) {
                formatted += '-' + remaining.substring(8, 12);
              }
            }
          }
        }
      }
      
      e.target.value = formatted;
    });

    // APIè°ƒç”¨å‡½æ•°
    async function apiCall(endpoint, data = {}) {
      const formData = new FormData();
      formData.append('ajax', '1');
      for (const [key, value] of Object.entries(data)) {
        formData.append(key, value);
      }

      const response = await fetch(endpoint, {
        method: 'POST',
        body: formData
      });

      if (!response.ok) {
        throw new Error('ç½‘ç»œé”™è¯¯');
      }

      return await response.json();
    }

    // Step1: éªŒè¯
    $('formVerify').addEventListener('submit', async (e)=>{
      e.preventDefault(); hideMsg();
      const code = $('code').value.trim(); if(!code){showMsg('è¯·è¾“å…¥æ¿€æ´»ç ');return;}
      
      const btn = $('btnVerify');
      btn.disabled = true;
      btn.textContent = 'éªŒè¯ä¸­...';
      
      try{
        const j = await apiCall('/api/verify-code', {
          action: 'verify_code',
          activation_code: code
        });
        
        if(!j.success){ showMsg(j.error||'éªŒè¯å¤±è´¥'); return; }
        $('email').textContent = j.email || 'ï¼ˆæ— é‚®ç®±ï¼‰';
        $('status').textContent = 'çŠ¶æ€ï¼š'+(j.status||'æœªçŸ¥');
        if(j.is_new){ $('newUser').classList.remove('hidden'); $('oldUser').classList.add('hidden'); }
        else { $('oldUser').classList.remove('hidden'); $('newUser').classList.add('hidden'); }
        setStep(2);
      }catch(err){ showMsg('ç½‘ç»œé”™è¯¯ï¼š'+err.message); }
      finally {
        btn.disabled = false;
        btn.textContent = 'éªŒè¯';
      }
    });

    // æ–°ç”¨æˆ·ï¼šæäº¤JSON
    $('btnSubmitJson').addEventListener('click', async (e)=>{
      e.preventDefault();
      hideMsg();
      const json=$('json').value.trim();
      if(!json){showMsg('è¯·è¾“å…¥JSON Token');return;}

      const btn = $('btnSubmitJson');
      btn.disabled = true;
      btn.textContent = 'å……å€¼ä¸­...';

      try{
        const j = await apiCall('/api/submit-json', {
          action: 'submit_json',
          json_token: json
        });
        showResult(j);
        setStep(3);
      }catch(err){
        showMsg('ç½‘ç»œé”™è¯¯ï¼š'+err.message);
      } finally {
        btn.disabled = false;
        btn.textContent = 'å¼€å§‹å……å€¼';
      }
    });

    // æ—§ç”¨æˆ·ï¼šå¤ç”¨
    $('btnReuse').addEventListener('click', async (e)=>{
      e.preventDefault();
      e.stopPropagation();
      hideMsg();
      const btn = $('btnReuse');
      btn.disabled = true;
      btn.textContent = 'å¤„ç†ä¸­...';

      try{
        const j = await apiCall('/api/reuse-record', {
          action: 'reuse_record'
        });
        showResult(j);
        setStep(3);
      }catch(err){
        showMsg('ç½‘ç»œé”™è¯¯ï¼š'+err.message);
      } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fa-solid fa-rotate mr-2"></i>å¤ç”¨å……å€¼è®°å½•';
      }
    });

    // æ˜¾ç¤ºæ›´æ–°TokenåŒºåŸŸ
    $('btnShowUpdate').addEventListener('click', ()=>{
      $('updateTokenSection').classList.remove('hidden');
      $('btnShowUpdate').classList.add('hidden');
      // ä¸ºæ›´æ–°Tokenè¾“å…¥æ¡†æ·»åŠ è„‰å†²æ•ˆæœ
      setTimeout(() => {
        $('updateJson').classList.add('highlight-pulse');
      }, 300);
    });

    // å–æ¶ˆæ›´æ–°Token
    $('btnCancelUpdate').addEventListener('click', ()=>{
      $('updateTokenSection').classList.add('hidden');
      $('btnShowUpdate').classList.remove('hidden');
      $('updateJson').value = '';
      // ç§»é™¤è„‰å†²æ•ˆæœ
      $('updateJson').classList.remove('highlight-pulse');
    });

    // æ›´æ–°Token
    $('btnUpdateToken').addEventListener('click', async (e)=>{
      e.preventDefault();
      hideMsg();
      const json = $('updateJson').value.trim();
      if(!json){ showMsg('è¯·è¾“å…¥JSON Token'); return; }

      const btn = $('btnUpdateToken');
      btn.disabled = true;
      btn.textContent = 'æ›´æ–°ä¸­...';

      try{
        const j = await apiCall('/api/update-token', {
          action: 'update_token',
          json_token: json
        });
        showResult(j);
        setStep(3);
      }catch(err){
        showMsg('ç½‘ç»œé”™è¯¯ï¼š'+err.message);
      } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fa-solid fa-upload mr-2"></i>æ›´æ–°Token';
      }
    });

    // é‡ç½®
    $('btnReset').addEventListener('click', ()=>{
      hideMsg();
      $('code').value='';
      $('json').value='';
      $('updateJson').value='';
      $('updateTokenSection').classList.add('hidden');
      $('btnShowUpdate').classList.remove('hidden');
      setStep(1);
    });

    setStep(1);
  </script>
</body>
</html>